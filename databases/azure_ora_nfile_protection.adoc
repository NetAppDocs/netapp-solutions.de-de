---
sidebar: sidebar 
permalink: databases/azure_ora_nfile_protection.html 
summary: In diesem Abschnitt wird beschrieben, wie Sie Ihre Oracle-Datenbank mit azacsnap-Tool schützen und Snapshot-Backup, Restore und Snapshots Tiering zu Azure Blob. 
keywords: Oracle, Azure, database, backup, restore 
---
= Schutz Ihrer Oracle Datenbank in Azure Cloud
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:table-stripes: odd
:imagesdir: ./../media/


link:azure_ora_nfile_procedures.html["Früher: Implementierungsverfahren"]

[role="lead"]
Autor(en): Allen Cao, NetApp Solutions Engineering



== Sichern Sie die Oracle Datenbank mit Snapshot mit dem AzAcSnap Tool

Das Azure Application-konsistenter Snapshot-Tool (AzAcSnap) ist ein Befehlszeilen-Tool, das die Datensicherung für Datenbanken anderer Anbieter ermöglicht. Sie übernimmt die gesamte Orchestrierung, die erforderlich ist, um sie in einen applikationskonsistenten Zustand zu versetzen, bevor sie einen Storage-Snapshot erstellt. Anschließend werden die Datenbanken in einen Betriebszustand zurückversetzt.

Im Fall von Oracle versetzen Sie die Datenbank in den Backup-Modus, um einen Snapshot zu erstellen und dann den Backup-Modus aus dem Datenbank zu nehmen.



=== Backup-Daten und Protokoll-Volumes

Die Sicherung kann auf dem Datenbank-Server-Host mit einfachen Shell-Skript eingerichtet werden, das den Snapshot-Befehl ausführt. Anschließend kann das Skript so geplant werden, dass es von crontab ausgeführt wird.

Im Allgemeinen hängt die Häufigkeit der Backups von dem gewünschten RTO und RPO ab. Die regelmäßige Erstellung von Snapshots belegt mehr Speicherplatz. Es besteht ein Kompromiss zwischen der Häufigkeit von Backup und dem Platzbedarf.

Daten-Volumes verbrauchen in der Regel mehr Storage als Protokoll-Volumes. Daher können Sie alle 15 bis 30 Minuten Snapshots auf Daten-Volumes erstellen und häufigere Snapshots auf Log-Volumes erstellen.

Sehen Sie sich die folgenden Beispiele für Backup-Skripte und Zeitplanung an.

Für Daten-Volume Snapshots:

[source, cli]
----
 # /bin/sh
cd /home/azacsnap/bin
. ~/.bash_profile
azacsnap -c backup --volume data --prefix acao-ora01-data --retention 36
azacsnap -c backup --volume other --prefix acao-ora01-log --retention 250
----
Für Momentaufnahmen des Protokollvolumens:

[source, cli]
----
 # /bin/sh
cd /home/azacsnap/bin
. ~/.bash_profile
azacsnap -c backup --volume other --prefix acao-ora01-log --retention 250
----
68b7e37ef318c0e56eabf3e1aded4216


NOTE: Beim Einrichten des Backups `azacsnap.json` Konfigurationsdatei: Fügen Sie alle Daten-Volumes, einschließlich des binären Volumes, zu hinzu `dataVolume` Und alle Log-Volumes auf `otherVolume`. Die maximale Aufbewahrung von Snapshots beträgt 250 Kopien.



=== Überprüfen Sie die Snapshots

Besuchen Sie das Azure-Portal > Azure NetApp Files/Volumes, um zu überprüfen, ob die Snapshots erfolgreich erstellt wurden.

image:db_ora_azure_anf_snap_01.PNG["Dieser Screenshot zeigt zwei Dateien in der Snapshot-Liste."]
image:db_ora_azure_anf_snap_02.PNG["Dieser Screenshot zeigt acht Dateien in der Snapshot-Liste."]



== Oracle Restore und Recovery aus lokalem Backup

Einer der wichtigsten Vorteile von Snapshot Backups besteht darin, dass es mit den Quell-Datenbank-Volumes verbunden ist und die primären Datenbank-Volumes nahezu sofort zurückgesetzt werden können.



=== Wiederherstellung von Oracle auf dem primären Server

Das folgende Beispiel zeigt, wie eine Oracle Datenbank über das Azure Dashboard und über die CLI auf demselben Oracle Host wiederhergestellt und wiederhergestellt wird.

. aa30a622663e0f34541394e008fe82cd
+
ea16560565f3889db4dabf938628b462

+
Copyright (c) 1982, 2019, Oracle. Alle Rechte vorbehalten.

+
Verbunden mit: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Produktionsversion 19.8.0.0.0

+
0409b2fce118cc126a532dea158d2943

+
bec6da77877c0793c1d3eb6c6896e98e

+
a5b83945adfd5370663cb2d9c4f31d09

+
6ba18fa8fa7d170dfd8fc80f0f3d39f7

+
d1d2dcb121f8bf8fd39724ea075c6409

+
a92090dde5e820fde0a68705ee3f2bd0

+
fd9736dfc88a182f9cb6e5f6a2b97487

+
 ID
+
[listing]
----
EVENT
--------------------------------------------------------------------------------
DT
---------------------------------------------------------------------------
         1
insert a data marker to validate snapshot restore
12-SEP-22 07.07.35.000000 PM
----
. Werfen Sie die Tabelle nach den Snapshot-Backups.
+
07b56c53a9fec8c477afb0cb5f2394af

+
dcd4d50ecf59b4752c161f0ddc44df44

+
Copyright (c) 1982, 2019, Oracle. Alle Rechte vorbehalten.

+
Verbunden mit: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Produktionsversion 19.8.0.0.0

+
bee0f13528c2f6f5b67053dc1e942328

+
cd85f26775e453b2177d5fcc6265b31d

+
07e18ec921a195478cdbab47d8d68d89

+
f06f4fbf6e3e0e45b0d4b241ceaf19c9

. Stellen Sie im Azure NetApp Files Dashboard das Protokoll-Volume in den letzten verfügbaren Snapshot wieder her. Wählen Sie *Lautstärke zurücksetzen*.
+
image:db_ora_azure_anf_restore_01.PNG["Dieser Screenshot zeigt die Methode der Umversion von Snapshots für Volumes im ANF-Dashboard."]

. Bestätigen Sie das Zurücksetzen des Volumes und klicken Sie auf *revert*, um die Umversion des Volumes auf die neueste verfügbare Sicherung abzuschließen.
+
image:db_ora_azure_anf_restore_02.PNG["Die „sind Sie sicher, dass Sie dies tun möchten?“ Seite für die Umversion des Snapshots."]

. Wiederholen Sie die gleichen Schritte für das Datenvolumen, und stellen Sie sicher, dass das Backup die Tabelle enthält, die wiederhergestellt werden soll.
+
image:db_ora_azure_anf_restore_03.PNG["Dieser Screenshot zeigt die Methode der Umversion von Snapshots für Datenvolumen im ANF-Dashboard."]

. Bestätigen Sie erneut die Umversion des Volumes und klicken Sie auf „Zurücksetzen“.
+
image:db_ora_azure_anf_restore_04.PNG["Die „sind Sie sicher, dass Sie dies tun möchten?“ Seite für die Umversion des Daten-Volume-Snapshots."]

. Synchronisieren Sie die Kontrolldateien neu, wenn Sie mehrere Kopien von ihnen haben, und ersetzen Sie die alte Kontrolldatei mit der neuesten verfügbaren Kopie.
+
952cd3804f479f3c31f123d064ccbdf5

. Melden Sie sich bei der Oracle-Server-VM an, und führen Sie Datenbank-Recovery mit sqlplus aus.
+
07b56c53a9fec8c477afb0cb5f2394af

+
125ab5cbfb90c4a6d038bcca4da6fdc4

+
Copyright (c) 1982, 2019, Oracle. Alle Rechte vorbehalten.

+
010621501012cd31b6666d17dad683d2

+
6bd3f70e5ab38ca26f8cabd390e15fc0

+
424459a4363a5afdd1e45d31fcd11efe

+
db9afd3f7adaff3fe1135208fa6b6a09

+
abc467423916c8ee7c16f566b4ab4ca8

+
db9afd3f7adaff3fe1135208fa6b6a09

+
479d2dfa77fdcde3bfd41fcdebbca1ff

+
db9afd3f7adaff3fe1135208fa6b6a09

+
c76ff2f7e10a42adf7faec8f9e6faeab

+
0e98028493ec8c4a1d181c0d71c3ec7b

+
f6c9ea366c01da7d664a8c7c3813e0bd

+
fd9736dfc88a182f9cb6e5f6a2b97487

+
 ID
+
[listing]
----
EVENT
--------------------------------------------------------------------------------
DT
---------------------------------------------------------------------------
         1
insert a data marker to validate snapshot restore
12-SEP-22 07.07.35.000000 PM


SQL> select systimestamp from dual;

 SYSTIMESTAMP
---------------------------------------------------------------------------
13-SEP-22 03.28.52.646977 PM +00:00
----


Dieser Bildschirm zeigt, dass die abfallende Tabelle mit lokalen Snapshot-Backups wiederhergestellt wurde.

link:azure_ora_nfile_migration.html["Als Nächstes geht es um die Datenbankmigration."]
