---
sidebar: sidebar 
permalink: databases/vcf_ora_rac_vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: 'Die Lösung bietet einen Überblick und Details zur Oracle-Bereitstellung und -Sicherung in VMware Cloud Foundation (VCF) mit vSphere Virtual Volumes (VVols) als primären Datenbank-Storage und Oracle Database in der RAC-Konfiguration (Real Application Clusters).' 
---
= TR-4997: Oracle RAC Deployment and Protection in VCF with VVols
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
Die Lösung bietet einen Überblick und Details zur Oracle-Bereitstellung und -Sicherung in VMware Cloud Foundation (VCF) mit vSphere Virtual Volumes (VVols) als primären Datenbank-Storage und Oracle Database in der RAC-Konfiguration (Real Application Clusters).



== Zweck

VMware vSphere Virtual Volumes (VVols) ist ein SAN/NAS-Management- und Integrations-Framework, das virtuelle Festplatten als native Storage-Objekte offenlegt und Array-basierte Vorgänge auf der Ebene der virtuellen Festplatten ermöglicht. Mit anderen Worten: VVols ermöglichen die VM- und SAN-/NAS-Geräte die Nutzung Array-basierter Datenservices mit VM-zentriertem Ansatz in der Granularität einer einzelnen virtuellen Festplatte. Mit VVols können Kunden die einzigartigen Funktionen ihrer aktuellen Storage-Investitionen nutzen und unterbrechungsfrei auf ein einfacheres und effizienteres Betriebsmodell umsteigen, das für virtuelle Umgebungen optimiert ist, die über alle Storage-Typen hinweg eingesetzt werden können.

In link:https://docs.netapp.com/us-en/netapp-solutions/databases/vcf_ora_si_vvol.html["TR-4996"^]haben wir die Implementierung und Sicherung einer Oracle-Datenbank mit einer Instanz in VCF mit VVols demonstriert. In dieser Dokumentation wird die Implementierung und Sicherung einer Oracle RAC Datenbank in einer VMware Cloud Foundation-Umgebung mit VVols als primärer Datenbank-Storage in einem NetApp ONTAP Storage-Cluster demonstriert. Die Oracle RAC-Datenbank wird so konfiguriert, als ob sie in lokalen Dateisystemen auf einem lokalen Speichersystem bereitgestellt wird. Dieser technische Bericht erläutert die Schritte zum Erstellen von VVols in VCF für die Oracle RAC-Implementierung. Zudem demonstrieren wir die Implementierung der Oracle RAC Datenbank in VCF auf VVols mit einem NetApp Automatisierungs-Toolkit und der RAC Datenbanksicherung mit dem NetApp SnapCenter UI Tool.

Diese Lösung eignet sich für folgende Anwendungsfälle:

* Oracle RAC-Datenbankbereitstellung in VCF mit VVols-Datastore auf NetApp ONTAP AFF als primären Datenbank-Storage
* Backup und Restore von Oracle Datenbanken in VCF mit VVols Datastore über das UI-Tool NetApp SnapCenter




== Zielgruppe

Diese Lösung ist für folgende Personen gedacht:

* Ein DBA, der Oracle RAC in VCF mit VVols Datastore auf NetApp ONTAP AFF als primären Datenbank-Storage implementieren möchte
* Ein Database Solution Architect, der Oracle RAC-Workloads in VCF mit VVols Datastore auf NetApp ONTAP AFF Storage testen möchte
* Ein Storage-Administrator, der eine in VCF mit VVols Datastore auf NetApp ONTAP AFF Storage implementierte Oracle RAC-Datenbank implementieren und managen möchte
* Applikationseigentümer, die eine Oracle RAC Datenbank in VCF mit vVol Datastore einrichten möchten




== Test- und Validierungsumgebung der Lösung

Das Testen und Validieren dieser Lösung wurde in einer Lab-Umgebung in VCF mit VVols Datastore auf NetApp ONTAP AFF Storage durchgeführt, die möglicherweise nicht mit der endgültigen Implementierungsumgebung übereinstimmt. Weitere Informationen finden Sie im Abschnitt <<Wichtige Faktoren für die Implementierung>>.



=== Der Netapp Architektur Sind

image:vcf_orarac_vvol_architecture.png["Dieses Bild zeigt ein detailliertes Bild der Oracle-Implementierungskonfiguration in AWS Public Cloud mit iSCSI und ASM."]



=== Hardware- und Softwarekomponenten

[cols="33%, 33%, 33%"]
|===


3+| *Hardware* 


| NetApp ONTAP AFF A300 | Version 9.14.1P4 | DS224 Shelf mit 24 NVMe-Festplatten, Gesamtkapazität 35.2 tib 


| VMware vSphere-Cluster | Version 8.02 | 12 CPUs x Intel(R) Xeon(R) Gold 5218 CPUs @ 2,30 GHz, 8 Nodes (4 Management- und 4 Workload-Domains) 


3+| *Software* 


| Redhat Linux | RHEL-8.6, 4.18.0-372.9.1.el8.x86_64-Kernel | Hosting von Oracle DB-Servern, Bereitstellung von RedHat Subskription für Tests 


| Windows Server | 2022 Standard, 10.0.20348 Build 20348 | Hosting von SnapCenter-Servern 


| Centos Linux | CentOS Linux Version 8.5.2111 | Hosting von Ansible-Controllern 


| Oracle Grid Infrastructure | Version 19.18 | RU-Patch p34762026_190000_Linux-x86-64.zip angewendet 


| Oracle Datenbank | Version 19.18 | RU-Patch p34765931_190000_Linux-x86-64.zip angewendet 


| Oracle OPatch | Version 12.2.0.1.36 | Neuestes Patch p6880880_190000_Linux-x86-64.zip 


| SnapCenter Server | Version 6.0 | Workgroup-Bereitstellung 


| SnapCenter Plug-in für VMware vSphere | Version 6.0 | Implementierung als eine ova VM zu vSphere-Cluster 


| ONTAP Tool für VMware vSphere | Version 9.13 | Implementierung als eine ova VM zu vSphere-Cluster 


| Öffnen Sie JDK | Version java-11-openjdk-11.0.23.0.9-3.el8.x86_64 | Anforderungen für SnapCenter Plugin auf DB VMs 
|===


=== Konfiguration der Oracle RAC-Datenbank in VCF

[cols="33%, 33%, 33%"]
|===


3+|  


| *RAC-Knoten* | * Datenbank* | *DB-Speicher* 


| ora01 | NTAP(NTAP_pdb1,NTAP_pdb2,NTAP_pdb3) | VVOLS-DATASTORES (VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS) AUF NetApp ONTAP AFF A300 


| ora02 | NTAP(NTAP_pdb1,NTAP_pdb2,NTAP_pdb3) | VVOLS-DATASTORES (VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS) AUF NetApp ONTAP AFF A300 
|===


=== Wichtige Faktoren für die Implementierung

* *Protokoll für VVols-zu-ONTAP-Cluster-Konnektivität.* NFS oder iSCSI sind eine gute Wahl. Die Leistungsstufen sind gleichwertig. In dieser Lösungsdemonstration haben wir iSCSI als Storage-Protokoll für die VVols-Konnektivität für den unterstrichenen ONTAP Storage-Cluster verwendet. Wenn die VCF-Infrastruktur unterstützt, werden FC/FCoE-, NVMe/FC-Protokolle auch für VVols-Datastores auf NetApp ONTAP unterstützt.
* *Oracle Storage-Layout auf VVols Datastores.* Für unsere Tests und Validierungen wurden fünf VVols Datastores für Oracle Binary, Oracle Cluster Registry/Vote, Oracle Daten und Oracle Log-Dateien implementiert. Es hat sich bewährt, verschiedene Typen von Oracle-Dateien in ihre eigenen Datastores zu trennen, sodass Datenbank-Backups, -Recoverys und -Klone ganz einfach gemanagt und ausgeführt werden können. Erstellen Sie dedizierte VVols für große Datenbanken und nutzen Sie VVols für kleinere Datenbanken oder Datenbanken mit einem ähnlichen QoS-Profil. 
* *Oracle Speicherredundanz.* Verwendung `Normal Redundancy` für kritische Oracle RAC-Cluster-Registry-/Vote-Dateien, so dass drei Vote-Dateien auf drei ASM-Festplatten-Ausfallgruppen einen optimalen Clusterschutz bieten und die Clusterregistrierung unter den ASM-Festplatten-Ausfallgruppen gespiegelt wird. Verwenden Sie `External Redundancy` für Oracle-Binär-, Daten- und Protokolldateien, um die Storage-Auslastung zu optimieren. Die unterstrichene ONTAP-RAID-DP bietet Datenschutz, wenn `External Redundancy` eingesetzt wird.
* *Zugangsdaten für ONTAP-Speicherauthentifizierung.* Verwenden Sie die Zugangsdaten auf ONTAP Cluster-Ebene nur für die ONTAP Storage-Cluster-Authentifizierung, einschließlich der SnapCenter-Konnektivität mit dem ONTAP Storage-Cluster oder der Konnektivität des ONTAP Tools zum ONTAP Storage-Cluster.
* *Bereitstellung von Storage vom VVols-Datastore auf Datenbank-VM.* Fügen Sie der Datenbank-VM aus dem VVols Datastore jeweils nur eine Festplatte hinzu. Das gleichzeitige Hinzufügen mehrerer Festplatten aus VVols Datastores wird derzeit nicht unterstützt.  
* *Datenbankschutz.* NetApp bietet eine SnapCenter Software-Suite für Datenbank-Backups und -Wiederherstellungen über eine benutzerfreundliche Oberfläche. NetApp empfiehlt die Implementierung eines solchen Management-Tools, damit Sie Snapshots schnell sichern, Datenbanken schnell wiederherstellen und wiederherstellen können.




== Lösungsimplementierung

In den folgenden Abschnitten werden Schritt-für-Schritt-Verfahren zur Implementierung der Oracle 19c-Datenbank in VCF mit VVols-Datastores auf NetApp ONTAP-Storage in einer Oracle RAC-Konfiguration beschrieben.



=== Voraussetzungen für die Bereitstellung

[%collapsible]
====
Die Bereitstellung erfordert die folgenden Voraussetzungen.

. Ein VMware VCF wurde eingerichtet. Informationen oder Anweisungen zum Erstellen eines VCF finden Sie in der VMware-Dokumentation link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["Dokumentation zu VMware Cloud Foundation"^].
. Stellen Sie drei Linux VMs, zwei VMs für den Oracle RAC Datenbank-Cluster und eine VM für den Ansible-Controller innerhalb der VCF Workload-Domäne bereit. Stellen Sie eine Windows Server VM für das Ausführen von NetApp SnapCenter Server bereit. Informationen zum Einrichten des Ansible-Controllers für die automatisierte Oracle-Datenbankbereitstellung finden Sie in den folgenden Ressourcen link:https://docs.netapp.com/us-en/netapp-solutions/automation/getting-started.html["Erste Schritte mit der Automatisierung von NetApp Lösungen"^].
. Für Oracle RAC Datenbank-VMs sollten mindestens zwei Netzwerkschnittstellen bereitgestellt sein – eine für den privaten Oracle RAC Interconnect und eine für Apps oder öffentlichen Datenverkehr.
. Das SnapCenter Plug-in Version 6.0 für VMware vSphere wurde im VCF implementiert. Weitere Informationen zur Plug-in-Bereitstellung finden Sie in den folgenden Ressourcen: link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["Dokumentation zum SnapCenter Plug-in für VMware vSphere"^].
. Das ONTAP Tool für VMware vSphere wurde in VCF implementiert. In den folgenden Ressourcen finden Sie Informationen zum ONTAP Tool zur Implementierung von VMware vSphere: link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Dokumentation zu ONTAP Tools für VMware vSphere"^]



NOTE: Stellen Sie sicher, dass Sie mindestens 50G im Oracle VM Root-Volume zugewiesen haben, damit ausreichend Speicherplatz für das Stage von Oracle Installationsdateien zur Verfügung steht.

====


=== Storage-Funktionsprofil erstellen

[%collapsible]
====
Erstellen Sie zunächst ein individuelles Storage-Funktionsprofil für den unterstrichenen ONTAP Storage, der den VVols Datastore hostet.

. Öffnen Sie über vSphere-Client-Verknüpfungen das NetApp ONTAP-Tool. Stellen Sie sicher, dass der ONTAP Storage-Cluster im Rahmen der Implementierung des ONTAP Tools hinzugefügt `Storage Systems` wurde.
+
image:vcf_ora_vvol_scp_01.png["Screenshot mit einer individuellen Konfiguration des Storage-Funktionsprofils"] image:vcf_ora_vvol_scp_00.png["Screenshot mit einer individuellen Konfiguration des Storage-Funktionsprofils"]

. Klicken Sie auf `Storage capability profile` , um ein benutzerdefiniertes Profil für Oracle hinzuzufügen. Benennen Sie das Profil, und fügen Sie eine kurze Beschreibung hinzu.
+
image:vcf_ora_vvol_scp_02.png["Screenshot mit einer individuellen Konfiguration des Storage-Funktionsprofils"]

. Wählen Sie die Storage-Controller-Kategorie aus: Performance, Kapazität oder Hybrid.
+
image:vcf_ora_vvol_scp_03.png["Screenshot mit einer individuellen Konfiguration des Storage-Funktionsprofils"]

. Wählen Sie das Protokoll aus.
+
image:vcf_ora_vvol_scp_04.png["Screenshot mit einer individuellen Konfiguration des Storage-Funktionsprofils"]

. Definieren Sie bei Bedarf eine QoS-Richtlinie.
+
image:vcf_ora_vvol_scp_05.png["Screenshot mit einer individuellen Konfiguration des Storage-Funktionsprofils"]

. Zusätzliche Storage-Attribute für das Profil. Stellen Sie sicher, dass die Verschlüsselung auf dem NetApp-Controller aktiviert ist, wenn Sie über die Verschlüsselungsfunktion verfügen möchten, oder es kann Probleme bei der Anwendung des Profils verursachen.
+
image:vcf_ora_vvol_scp_06.png["Screenshot mit einer individuellen Konfiguration des Storage-Funktionsprofils"]

. Überprüfen Sie die Zusammenfassung, und beenden Sie die Erstellung des Storage-Funktionsprofils.
+
image:vcf_ora_vvol_scp_07.png["Screenshot mit einer individuellen Konfiguration des Storage-Funktionsprofils"]



====


=== VVols Datastore erstellen und konfigurieren

[%collapsible]
====
Wenn die Voraussetzungen erfüllt sind, melden Sie sich über vSphere Client als Admin-Benutzer bei VCF an und navigieren Sie zur Workload-Domäne. Erstellen Sie VVols nicht mit der integrierten VMware Storage-Option. Stattdessen können Sie VVols mit dem Tool NetApp ONTAP erstellen. Im Folgenden werden die Verfahren zum Erstellen und Konfigurieren von VVols beschrieben.

. Der VVols Erstellungsworkflow kann entweder über die Benutzeroberfläche des ONTAP Tools oder über das VCF Workload Domain Cluster ausgelöst werden.
+
image:vcf_ora_vvol_datastore_01.png["Screenshot mit der Konfiguration des VVols Datastore"]

+
image:vcf_ora_vvol_datastore_01_2.png["Screenshot mit der Konfiguration des VVols Datastore"]

. Allgemeine Informationen für Datenspeicher, einschließlich Bereitstellungsziel, Typ, Name und Protokoll eingeben
+
image:vcf_orarac_vvol_datastore_01.png["Screenshot mit der Konfiguration des VVols Datastore"]

. Wählen Sie das benutzerdefinierte Profil der Storage-Funktionen aus, das aus dem vorherigen Schritt, der , und , erstellt wurde, wobei VVols erstellt `Storage system` `Storage VM`werden sollen.
+
image:vcf_orarac_vvol_datastore_02.png["Screenshot mit der Konfiguration des VVols Datastore"]

. Wählen Sie `Create new volumes`, geben Sie den Namen und die Größe des Volumens ein und klicken Sie dann auf `ADD` `NEXT` , um zur Übersichtsseite zu gelangen.
+
image:vcf_orarac_vvol_datastore_03.png["Screenshot mit der Konfiguration des VVols Datastore"] image:vcf_orarac_vvol_datastore_04.png["Screenshot mit der Konfiguration des VVols Datastore"]

. Klicken Sie hier `Finish` , um einen VVols-Datastore für Oracle-Binärdatei zu erstellen.
+
image:vcf_orarac_vvol_datastore_05.png["Screenshot mit der Konfiguration des VVols Datastore"]

. Erstellen Sie einen Datastore für die Oracle-Clusterregistrierung oder CRS.
+
image:vcf_orarac_vvol_datastore_06.png["Screenshot mit der Konfiguration des VVols Datastore"]

+

NOTE: Aus Gründen der Performance oder Redundanz können Sie einem VVols Datastore auf einem VVols-Controller-Node oder über die ONTAP-Controller-Nodes hinweg mehrere Volumes hinzufügen.

. Erstellen Sie einen Datastore für Oracle-Daten. Im Idealfall erstellen Sie separate Datastores auf jedem ONTAP Controller Node und setzen Oracle ASM ein, um Daten über Controller-Nodes zu verteilen, um die Auslastung der ONTAP Storage-Cluster-Kapazität zu maximieren.
+
image:vcf_orarac_vvol_datastore_06_1.png["Screenshot mit der Konfiguration des VVols Datastore"] image:vcf_orarac_vvol_datastore_06_2.png["Screenshot mit der Konfiguration des VVols Datastore"]

. Erstellen Sie den Datastore für das Oracle-Protokoll. Angesichts der sequenziellen Natur des Oracle-Protokollschreibens ist es gut, es einfach auf einem einzigen ONTAP-Controller-Knoten zu platzieren.
+
image:vcf_orarac_vvol_datastore_06_3.png["Screenshot mit der Konfiguration des VVols Datastore"]

. Validieren Sie die Oracle-Datastores nach der Implementierung.
+
image:vcf_orarac_vvol_datastore_07.png["Screenshot mit der Konfiguration des VVols Datastore"]



====


=== Erstellen von VM Storage-Richtlinien anhand von Storage-Funktionsprofilen

[%collapsible]
====
Bevor Sie Storage aus einem VVols-Datastore in eine Datenbank-VM bereitstellen, fügen Sie eine VM-Storage-Richtlinie basierend auf dem Storage-Funktionsprofil hinzu, das aus dem vorherigen Schritt erstellt wurde. Im Folgenden werden die Verfahren beschrieben.

. Öffnen und markieren Sie in den vSphere-Client-Menüs `Policies and Profiles` `VM Storage Policies`. Klicken Sie hier, `Create` um den Workflow zu öffnen `VM Storage Policies` .
+
image:vcf_ora_vvol_vm_policy_01.png["Screenshot mit der Konfiguration einer VM-Storage-Richtlinie"]

. Benennen Sie die Richtlinie für den VM-Storage.
+
image:vcf_ora_vvol_vm_policy_02.png["Screenshot mit der Konfiguration einer VM-Storage-Richtlinie"]

. Check-in `Datastore specific rules` `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf_ora_vvol_vm_policy_03.png["Screenshot mit der Konfiguration einer VM-Storage-Richtlinie"]

. Wählen Sie für die Regeln NetApp.Clustered.Data.ONTAP.VP.vvol `Placement`das im vorherigen Schritt erstellte individuelle Storage-Kapazitätsprofil aus.
+
image:vcf_ora_vvol_vm_policy_04.png["Screenshot mit der Konfiguration einer VM-Storage-Richtlinie"]

. Wählen Sie unter den Regeln für NetApp.Clustered.Data.ONTAP.VP.vvol `Replication`aus, `Disabled` ob VVols nicht repliziert werden.
+
image:vcf_ora_vvol_vm_policy_04_1.png["Screenshot mit der Konfiguration einer VM-Storage-Richtlinie"]

. Auf der Seite zur Storage-Kompatibilität werden kompatible VVols Datastores in der VCF-Umgebung angezeigt.
+
image:vcf_orarac_vvol_datastore_08.png["Screenshot mit der Konfiguration einer VM-Storage-Richtlinie"]

. Überprüfen und beenden, um die VM-Speicherrichtlinie zu erstellen.
+
image:vcf_ora_vvol_vm_policy_06.png["Screenshot mit der Konfiguration einer VM-Storage-Richtlinie"]

. Soeben erstellte VM-Storage-Richtlinie validieren
+
image:vcf_ora_vvol_vm_policy_07.png["Screenshot mit der Konfiguration einer VM-Storage-Richtlinie"]



====


=== Weisen Sie RAC-VMs Festplatten aus VVols-Datastores zu und konfigurieren Sie den DB-Storage

[%collapsible]
====
Fügen Sie über vSphere Client die gewünschten Festplatten aus den VVols-Datastores zur Datenbank-VM hinzu, indem Sie die VM-Einstellungen bearbeiten. Melden Sie sich dann bei der VM an, um die Binärfestplatte zu formatieren und in Mount-Punkte /u01 zu mounten. Im Folgenden werden die genauen Schritte und Aufgaben erläutert.

. Bevor Sie Festplatten vom Datastore an die Datenbank-VM zuweisen, melden Sie sich an den VMware ESXi-Hosts an, um zu validieren und sicherzustellen, dass Multi-Writer (GBLAllowMW-Wert auf 1 festgelegt) auf ESXi-Ebene aktiviert sind.
+
....
[root@vcf-wkld-esx01:~] which esxcli
/bin/esxcli
[root@vcf-wkld-esx01:~] esxcli system settings advanced list -o /VMFS3/GBLAllowMW
   Path: /VMFS3/GBLAllowMW
   Type: integer
   Int Value: 1
   Default Int Value: 1
   Min Value: 0
   Max Value: 1
   String Value:
   Default String Value:
   Valid Characters:
   Description: Allow multi-writer GBLs.
   Host Specific: false
   Impact: none
[root@vcf-wkld-esx01:~]

....
. Fügen Sie einen neuen, dedizierten SCSI-Controller zur Verwendung mit Oracle RAC-Laufwerken hinzu. Deaktivieren Sie die SCSI-Busfreigabe.
+
image:vcf_orarac_vvol_vm_01.png["Screenshot mit einer VM Storage-Konfiguration"]

. Von RAC Node 1 - ora01, fügen Sie eine Festplatte zu VM für Oracle binären Speicher ohne Freigabe.
+
image:vcf_orarac_vvol_vm_02.png["Screenshot mit einer VM Storage-Konfiguration"]

. Fügen Sie vom RAC-Knoten 1 aus drei Festplatten zur VM für Oracle RAC CRS-Speicher hinzu, und aktivieren Sie die Multi-Writer-Freigabe.
+
image:vcf_orarac_vvol_vm_03.png["Screenshot mit einer VM Storage-Konfiguration"] image:vcf_orarac_vvol_vm_04.png["Screenshot mit einer VM Storage-Konfiguration"] image:vcf_orarac_vvol_vm_05.png["Screenshot mit einer VM Storage-Konfiguration"]

. Fügen Sie ab RAC Node 1 jeweils zwei Festplatten aus jedem Datenspeicher für Daten zur VM für gemeinsam genutzten Oracle Datenspeicher hinzu.
+
image:vcf_orarac_vvol_vm_06.png["Screenshot mit einer VM Storage-Konfiguration"] image:vcf_orarac_vvol_vm_08.png["Screenshot mit einer VM Storage-Konfiguration"] image:vcf_orarac_vvol_vm_09.png["Screenshot mit einer VM Storage-Konfiguration"] image:vcf_orarac_vvol_vm_10.png["Screenshot mit einer VM Storage-Konfiguration"]

. Fügen Sie vom RAC-Knoten 1 aus zwei Festplatten zur VM aus dem Protokolldatenspeicher für gemeinsamen Oracle-Protokolldateispeicher hinzu.
+
image:vcf_orarac_vvol_vm_11.png["Screenshot mit einer VM Storage-Konfiguration"] image:vcf_orarac_vvol_vm_12.png["Screenshot mit einer VM Storage-Konfiguration"]

. Fügen Sie vom RAC Node 2 eine Festplatte zur VM hinzu, um den Binärspeicher von Oracle ohne Freigabe zu erhalten.
+
image:vcf_orarac_vvol_vm_13.png["Screenshot mit einer VM Storage-Konfiguration"]

. Fügen Sie im RAC-Knoten 2 weitere gemeinsam genutzte Festplatten hinzu `Existing Hard Disks`, indem Sie die Option auswählen und die Multi-Writer-Freigabe für jedes gemeinsam genutzte Laufwerk aktivieren.
+
image:vcf_orarac_vvol_vm_14.png["Screenshot mit einer VM Storage-Konfiguration"] image:vcf_orarac_vvol_vm_15.png["Screenshot mit einer VM Storage-Konfiguration"]

. Fügen Sie von VM `Edit Settings`, `Advanced Parameters`Attribut mit Wert hinzu `disk.enableuuid` `TRUE`. Die VM muss heruntergefahren werden, um den erweiterten Parameter hinzuzufügen. Wenn Sie diese Option aktivieren, kann SnapCenter das vVol in Ihrer Umgebung präzise identifizieren. Dies sollte auf allen RAC-Knoten durchgeführt werden.
+
image:vcf_ora_vvol_vm_uuid.png["Screenshot mit einer VM Storage-Konfiguration"]

. Starten Sie jetzt die VM neu. Melden Sie sich bei VM als Admin-Benutzer über ssh an, um die neu hinzugefügten Festplatten zu prüfen.
+
....
[admin@ora01 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora01 ~]$

[admin@ora02 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora02 ~]$


....
. Partitionieren Sie von jedem RAC-Knoten aus die Oracle-Binärfestplatte (/dev/sdb) als primäre und einzelne Partition, indem Sie einfach die Standardoptionen akzeptieren.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
. Formatieren Sie die partitionierten Festplatten als xfs-Dateisysteme.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
. Mounten Sie die Festplatte zum Mount-Punkt /u01.
+
....
[admin@ora01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G   36K  7.7G   1% /dev
tmpfs                  7.8G  1.4G  6.4G  18% /dev/shm
tmpfs                  7.8G   34M  7.7G   1% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   29G   16G  66% /
/dev/sda2             1014M  249M  766M  25% /boot
/dev/sda1              599M  5.9M  593M   1% /boot/efi
/dev/sdb1               50G   24G   27G  47% /u01
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G     0  1.6G   0% /run/user/54331
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000


....
. Fügen Sie Mount-Punkte zu /etc/fstab hinzu, damit Laufwerke gemountet werden, wenn VM neu gestartet wird.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
....


====


=== Oracle RAC-Bereitstellung in VCF

[%collapsible]
====
Es wird empfohlen, das NetApp Automatisierungs-Toolkit für die Implementierung von Oracle RAC in VCF mit VVols zu nutzen. Lesen Sie den enthaltenen Befehl (Readme) sorgfältig durch und konfigurieren Sie Bereitstellungsparameter-Dateien wie Deployment Target file - Hosts, Global Variables file - vars/vars.yml und lokale DB VM Variables file - Host_vars/Host_Name.yml, indem Sie die Anweisungen im Toolkit befolgen. Im Folgenden werden die einzelnen Schritte beschrieben.

. Melden Sie sich bei der Ansible-Controller-VM als Admin-Benutzer über ssh an und klonen Sie eine Kopie des Automatisierungs-Toolkits für die Implementierung von Oracle RAC in VCF mit VVols.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_rac.git
----
. Stellen Sie die folgenden Oracle-Installationsdateien in den Ordner /tmp/Archive auf der Datenbank-VM des RAC-Knotens 1 bereit. Der Ordner sollte allen Benutzern Zugriff mit 777 Berechtigung erlauben.
+
....
LINUX.X64_193000_grid_home.zip
p34762026_190000_Linux-x86-64.zip
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. Richten Sie die Authentifizierung ohne SSH-Schlüssel zwischen dem Ansible-Controller und den Datenbank-VMs ein, die ein SSH-Schlüsselpaar erzeugen und den öffentlichen Schlüssel in die Datenbank-VMs admin-Benutzer-Stammverzeichnis .ssh-Ordner Authorized_keys-Datei kopieren muss.
+
[source, cli]
----
ssh-keygen
----
. Konfigurieren Sie die benutzerdefinierten Parameter-Dateien des Ziel-Hosts. Im Folgenden finden Sie ein Beispiel für eine typische Konfiguration für die Zielhostdatei - Hosts.
+
....
#Oracle hosts
[oracle]
ora01 ansible_host=10.61.180.21 ansible_ssh_private_key_file=ora01.pem
ora02 ansible_host=10.61.180.22 ansible_ssh_private_key_file=ora02.pem

....
. Konfigurieren Sie die benutzerdefinierten spezifischen Parameterdateien für den lokalen Host. Im Folgenden finden Sie ein Beispiel einer typischen Konfiguration für die lokale Datei Host_Name.yml - ora01.yml.
+
....

# Binary lun
ora_bin: /dev/sdb

# Host DB configuration
ins_sid: "{{ oracle_sid }}1"
asm_sid: +ASM1

....
. Konfigurieren Sie die benutzerdefinierte Datei für globale Parameter. Im Folgenden finden Sie ein Beispiel für eine typische Konfiguration für die globale Parameterdatei - vars.yml
+
....

#######################################################################
### ONTAP env specific config variables                             ###
#######################################################################

# ONTAP storage platform: on-prem, vmware-vvols
ontap_platform: vmware-vvols

# Prerequisite to create five vVolss in VMware vCenter
# VCF_ORA_BINS - Oracle binary
# VCF_ORA_CRS  - Oracle cluster registry and vote
# VCF_ORA_DAT1 - Oracle data on node1
# VCF_ORA_DAT2 - Oracle data on node2
# VCF_ORA_LOGS - Oracle logs on node1 or node2

# Oracle disks are added to VM from vVols: 1 binary disk, 3 CRS disks, 4 data disks, and 2 log disks.


######################################################################
### Linux env specific config variables                            ###
######################################################################

redhat_sub_username: XXXXXXXX
redhat_sub_password: "XXXXXXXX"

# Networking configuration
cluster_pub_ip:
  - {ip: 10.61.180.21, hostname: ora01}
  - {ip: 10.61.180.22, hostname: ora02}

cluster_pri_ip:
  - {ip: 172.21.166.22, hostname: ora01-pri}
  - {ip: 172.21.166.24, hostname: ora02-pri}

cluster_vip_ip:
  - {ip: 10.61.180.93, hostname: ora01-vip}
  - {ip: 10.61.180.94, hostname: ora02-vip}

cluster_scan_name: ntap-scan
cluster_scan_ip:
  - {ip: 10.61.180.90, hostname: ntap-scan}
  - {ip: 10.61.180.91, hostname: ntap-scan}
  - {ip: 10.61.180.92, hostname: ntap-scan}


#####################################################################
### DB env specific install and config variables                  ###
#####################################################################

# Shared Oracle RAC storage
ora_crs:
  - { device: /dev/sdc, name: ora_crs_01 }
  - { device: /dev/sdd, name: ora_crs_02 }
  - { device: /dev/sde, name: ora_crs_03 }

ora_data:
  - { device: /dev/sdf, name: ora_data_01 }
  - { device: /dev/sdg, name: ora_data_02 }
  - { device: /dev/sdh, name: ora_data_03 }
  - { device: /dev/sdi, name: ora_data_04 }

ora_logs:
  - { device: /dev/sdj, name: ora_logs_01 }
  - { device: /dev/sdk, name: ora_logs_02 }

# Oracle RAC configuration

oracle_sid: NTAP
cluster_name: ntap-rac
cluster_nodes: ora01,ora02
cluster_domain: solutions.netapp.com
grid_cluster_nodes: ora01:ora01-vip:HUB,ora02:ora02-vip:HUB
network_interface_list: ens33:10.61.180.0:1,ens34:172.21.166.0:5
memory_limit: 10240

# Set initial password for all required Oracle passwords. Change them after installation.
initial_pwd_all: "XXXXXXXX"

....
. Führen Sie über den Ansible Controller, das geklonte Automatisierungs-Toolkit-Home-Verzeichnis /Home/admin/na_oracle_Deploy_rac, ein vorbereitendes Playbook zur Einrichtung der ansible-Voraussetzungen aus.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Linux-KonfigurationskPlaybook ausführen.
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Ausführen des Playbooks für die Oracle Implementierung
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml
----
. Optional können alle oben genannten Playbooks über eine einzelne Playbook-Ausführung ausgeführt werden.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml
----


====


=== Validierung der Oracle RAC-Bereitstellung in VCF

[%collapsible]
====
Dieser Abschnitt enthält Details zur Validierung der Oracle RAC-Bereitstellung in VCF, um sicherzustellen, dass alle Oracle RAC-Ressourcen vollständig bereitgestellt, konfiguriert und wie erwartet funktionieren.

. Melden Sie sich bei RAC VM als Admin-Benutzer an, um die Oracle Grid-Infrastruktur zu validieren.
+
....
[admin@ora01 ~]$ sudo su
[root@ora01 admin]# su - grid
[grid@ora01 ~]$ crsctl stat res -t
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.LISTENER.lsnr
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.chad
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.net1.network
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.ons
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.proxy_advm
               OFFLINE OFFLINE      ora01                    STABLE
               OFFLINE OFFLINE      ora02                    STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.ASMNET1LSNR_ASM.lsnr(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.DATA.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN1.lsnr
      1        ONLINE  ONLINE       ora01                    STABLE
ora.LISTENER_SCAN2.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN3.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.RECO.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.VOTE.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.asm(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    Started,STABLE
      2        ONLINE  ONLINE       ora02                    Started,STABLE
ora.asmnet1.asmnetwork(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.cvu
      1        ONLINE  ONLINE       ora02                    STABLE
ora.ntap.db
      1        ONLINE  ONLINE       ora01                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
      2        ONLINE  ONLINE       ora02                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
ora.ora01.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.ora02.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.qosmserver
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan1.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.scan2.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan3.vip
      1        ONLINE  ONLINE       ora02                    STABLE
--------------------------------------------------------------------------------
[grid@ora01 ~]$

....
. Validierung von Oracle ASM.
+
....
[grid@ora01 ~]$ asmcmd
ASMCMD> lsdg
State    Type    Rebal  Sector  Logical_Sector  Block       AU  Total_MB  Free_MB  Req_mir_free_MB  Usable_file_MB  Offline_disks  Voting_files  Name
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163723                0          163723              0             N  DATA/
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163729                0          163729              0             N  RECO/
MOUNTED  NORMAL  N         512             512   4096  4194304     30720    29732            10240            9746              0             Y  VOTE/
ASMCMD> lsdsk
Path
AFD:ORA_CRS_01
AFD:ORA_CRS_02
AFD:ORA_CRS_03
AFD:ORA_DATA_01
AFD:ORA_DATA_02
AFD:ORA_DATA_03
AFD:ORA_DATA_04
AFD:ORA_LOGS_01
AFD:ORA_LOGS_02
ASMCMD> afd_state
ASMCMD-9526: The AFD state is 'LOADED' and filtering is 'ENABLED' on host 'ora01'
ASMCMD>

....
. Auflisten von Clusterknoten
+
....

[grid@ora01 ~]$ olsnodes
ora01
ora02

....
. OCR/VOTE validieren.
+
....
[grid@ora01 ~]$ ocrcheck
Status of Oracle Cluster Registry is as follows :
         Version                  :          4
         Total space (kbytes)     :     901284
         Used space (kbytes)      :      84536
         Available space (kbytes) :     816748
         ID                       :  118267044
         Device/File Name         :      +VOTE
                                    Device/File integrity check succeeded

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

         Cluster registry integrity check succeeded

         Logical corruption check bypassed due to non-privileged user

[grid@ora01 ~]$ crsctl query css votedisk
##  STATE    File Universal Id                File Name Disk group
--  -----    -----------------                --------- ---------
 1. ONLINE   1ca3fcb0bd354f8ebf00ac97d70e0824 (AFD:ORA_CRS_01) [VOTE]
 2. ONLINE   708f84d505a54f58bf41124e09a5115a (AFD:ORA_CRS_02) [VOTE]
 3. ONLINE   133ecfcedb684fe6bfdc1899b90f91c7 (AFD:ORA_CRS_03) [VOTE]
Located 3 voting disk(s).
[grid@ora01 ~]$


....
. Oracle Listener validieren
+
....
[grid@ora01 ~]$ lsnrctl status listener

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 10:21:38

Copyright (c) 1991, 2022, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production
Start Date                14-AUG-2024 16:24:48
Uptime                    1 days 17 hr. 56 min. 49 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/grid/19.0.0/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/ora01/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.21)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.93)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcps)(HOST=ora01.solutions.netapp.com)(PORT=5500))(Security=(my_wallet_directory=/u01/app/oracle2/product/19.0.0/NTAP/admin/NTAP/xdb_wallet))(Presentation=HTTP)(Session=RAW))
Services Summary...
Service "+ASM" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_DATA" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_RECO" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_VOTE" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "1fbf0aaa1d13cb5ae06315b43d0ab734.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf142e7db2d090e06315b43d0a6894.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf203c3a46d7bae06315b43d0ae055.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAP.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAPXDB.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb1.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb2.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb3.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
The command completed successfully
[grid@ora01 ~]$

[grid@ora01 ~]$ tnsping ntap-scan

TNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 12:07:58

Copyright (c) 1997, 2022, Oracle.  All rights reserved.

Used parameter files:
/u01/app/grid/19.0.0/network/admin/sqlnet.ora

Used EZCONNECT adapter to resolve the alias
Attempting to contact (DESCRIPTION=(CONNECT_DATA=(SERVICE_NAME=))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.90)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.91)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.92)(PORT=1521)))
OK (10 msec)


....
. Wechseln Sie zum oracle Benutzer, um die geclusterte Datenbank zu validieren.
+
....
[oracle@ora02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Aug 16 11:32:23 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP      READ WRITE           ARCHIVELOG

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> select name from v$datafile
  2  union
  3  select name from v$controlfile
  4  union
  5  select member from v$logfile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/sysaux.275.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/system.274.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undo_2.277.1177083853
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undotbs1.273.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/users.278.1177083901
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/sysaux.281.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/system.280.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undo_2.283.1177084061
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undotbs1.279.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/users.284.1177084103
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/sysaux.287.1177084105

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/system.286.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undo_2.289.1177084123
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undotbs1.285.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/users.290.1177084125
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.266.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.265.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.267.1177081837
+DATA/NTAP/CONTROLFILE/current.261.1177080403
+DATA/NTAP/DATAFILE/sysaux.258.1177080245
+DATA/NTAP/DATAFILE/system.257.1177080129
+DATA/NTAP/DATAFILE/undotbs1.259.1177080311

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/DATAFILE/undotbs2.269.1177082203
+DATA/NTAP/DATAFILE/users.260.1177080311
+DATA/NTAP/ONLINELOG/group_1.262.1177080427
+DATA/NTAP/ONLINELOG/group_2.263.1177080427
+DATA/NTAP/ONLINELOG/group_3.270.1177083297
+DATA/NTAP/ONLINELOG/group_4.271.1177083313
+RECO/NTAP/CONTROLFILE/current.256.1177080403
+RECO/NTAP/ONLINELOG/group_1.257.1177080427
+RECO/NTAP/ONLINELOG/group_2.258.1177080427
+RECO/NTAP/ONLINELOG/group_3.259.1177083313
+RECO/NTAP/ONLINELOG/group_4.260.1177083315

33 rows selected.


....
. Oder melden Sie sich bei EM Express an, um die RAC-Datenbank nach erfolgreicher Ausführung des Playbooks zu validieren.
+
image:vcf_orarac_vvol_em_01.png["Screenshot mit Oracle EM Express-Konfiguration."] image:vcf_orarac_vvol_em_02.png["Screenshot mit Oracle EM Express-Konfiguration."]



====


=== Backup und Recovery von Oracle RAC Datenbanken in VCF mit SnapCenter



==== SnapCenter-Einrichtung

[%collapsible]
====
SnapCenter Version 6 verfügt über viele Funktionsverbesserungen gegenüber Version 5, einschließlich der Unterstützung für VMware VVols Datastore. SnapCenter setzt auf ein Host-seitiges Plug-in auf einer Datenbank-VM, um applikationsspezifische Management-Aktivitäten zur Datensicherung durchzuführen. Detaillierte Informationen zum NetApp SnapCenter Plug-in für Oracle finden Sie in dieser Dokumentation link:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Welche Möglichkeiten bietet das Plug-in für Oracle Database"^]. Im Folgenden finden Sie grundlegende Schritte zum Einrichten von SnapCenter Version 6 für Oracle RAC-Datenbank-Backup und -Wiederherstellung in VCF.

. Laden Sie die Version 6 der SnapCenter Software von der NetApp Support-Website herunter: link:https://mysupport.netapp.com/site/downloads["NetApp Support-Downloads"^].
. Melden Sie sich beim SnapCenter an, der die Windows VM als Administrator hostet. Installieren Sie die Voraussetzungen für SnapCenter 6.0.
+
image:vcf_ora_vvol_snapctr_prerequisites.png["Screenshot mit SnapCenter 6.0-Voraussetzungen."]

. Installieren Sie als Administrator die neueste java JDK von link:https://www.java.com/en/["Holen Sie sich Java für Desktop-Anwendungen"^].
+

NOTE: Wenn Windows-Server in einer Domänenumgebung bereitgestellt wird, fügen Sie der lokalen Administratorgruppe des SnapCenter-Servers einen Domänenbenutzer hinzu, und führen Sie die SnapCenter-Installation mit dem Domänenbenutzer aus.

. Melden Sie sich bei der SnapCenter-Benutzeroberfläche über HTTPS-Port 8846 als Installationsbenutzer an, um SnapCenter für Oracle zu konfigurieren.
+
image:vcf_ora_vvol_snapctr_deploy_01.png["Screenshot mit der SnapCenter-Konfiguration"]

. Überprüfen Sie `Get Started` das Menü, um sich über SnapCenter auf dem neuesten Stand zu halten, wenn Sie ein neuer Benutzer sind.
+
image:vcf_ora_vvol_snapctr_deploy_02.png["Screenshot mit der SnapCenter-Konfiguration"]

. Aktualisierung `Hypervisor Settings` In globalen Einstellungen.
+
image:aws_ora_fsx_vmc_snapctr_01.png["Screenshot mit der SnapCenter-Konfiguration"]

. Fügen Sie den ONTAP Storage-Cluster mit der Cluster-Management-IP hinzu `Storage Systems` und authentifiziert über die Cluster-Admin-Benutzer-ID.
+
image:vcf_ora_vvol_snapctr_deploy_06.png["Screenshot mit der SnapCenter-Konfiguration"] image:vcf_ora_vvol_snapctr_deploy_07.png["Screenshot mit der SnapCenter-Konfiguration"]

. Fügen Sie Oracle RAC Datenbank-VMs und vSphere Plugin VM `Credential` für SnapCenter-Zugriff auf DB VM und vSphere Plugin VM. Die Anmeldeinformationen sollten über die Sudo-Berechtigung auf den Linux-VMs verfügen. Sie können verschiedene Anmeldeinformationen für verschiedene Management-Benutzer-IDs für die VMs erstellen. VShpere Plugin VM Management-Benutzer-ID wird definiert, wenn die Plugin-VM in vCenter bereitgestellt wird.
+
image:aws_ora_fsx_vmc_snapctr_03.png["Screenshot mit der SnapCenter-Konfiguration"]

. Fügen Sie die Oracle RAC Datenbank-VM in VCF zu hinzu `Hosts`, wobei im vorherigen Schritt die DB VM-Anmeldeinformationen erstellt wurden.
+
image:vcf_orarac_vvol_snapctr_setup_01.png["Screenshot mit der SnapCenter-Konfiguration"] image:vcf_orarac_vvol_snapctr_setup_02.png["Screenshot mit der SnapCenter-Konfiguration"] image:vcf_orarac_vvol_snapctr_setup_03.png["Screenshot mit der SnapCenter-Konfiguration"]

. Ebenso fügen Sie NetApp VMware Plugin VM `Hosts` mit vSphere Plugin VM Zugangsdaten im vorherigen Schritt erstellt.
+
image:vcf_ora_vvol_snapctr_deploy_11.png["Screenshot mit der SnapCenter-Konfiguration"] image:vcf_orarac_vvol_snapctr_setup_04.png["Screenshot mit der SnapCenter-Konfiguration"]

. Nachdem die Oracle Datenbank auf der DB VM erkannt wurde, kehren Sie schließlich zurück, um die Backup-Richtlinien für Oracle Datenbanken zu `Settings`-`Policies` erstellen. Im Idealfall erstellen Sie eine separate Backup-Richtlinie für Archivprotokolle, um häufigere Backups zu ermöglichen, um Datenverlust bei einem Ausfall zu minimieren.
+
image:aws_ora_fsx_vmc_snapctr_02.png["Screenshot mit der SnapCenter-Konfiguration"]




NOTE: Stellen Sie sicher, dass der Name des SnapCenter-Servers auf die IP-Adresse von der VM DB und vSphere Plugin VM aufgelöst werden kann. Ebenso können der VM-Name der DB und der VM-Name des vSphere Plugin auf die IP-Adresse vom SnapCenter-Server aufgelöst werden.

====


==== Datenbank-Backup

[%collapsible]
====
SnapCenter nutzt ONTAP Volume Snapshot für ein wesentlich schnelleres Backup, Restore oder Klonen von Datenbanken im Vergleich zu herkömmlichen RMAN-basierten Methoden. Die Snapshots sind anwendungskonsistent, da die Datenbank vor einem Snapshot in den Oracle-Backup-Modus versetzt wird.

. Von `Resources` Registerkarte werden alle Datenbanken auf der VM automatisch erkannt, nachdem die VM zu SnapCenter hinzugefügt wurde. Zunächst wird der Datenbankstatus als angezeigt `Not protected`.
+
image:vcf_orarac_vvol_snapctr_bkup_01.png["Screenshot mit der SnapCenter-Konfiguration"]

. Klicken Sie auf Datenbank, um einen Workflow zu starten, um den Schutz für die Datenbank zu aktivieren.
+
image:vcf_orarac_vvol_snapctr_bkup_02.png["Screenshot mit der SnapCenter-Konfiguration"]

. Wenden Sie die Backup-Richtlinie an, und richten Sie bei Bedarf eine Planung ein.
+
image:vcf_orarac_vvol_snapctr_bkup_03.png["Screenshot mit der SnapCenter-Konfiguration"]

. Benachrichtigung über Backup-Auftrag einrichten, falls erforderlich.
+
image:vcf_orarac_vvol_snapctr_bkup_05.png["Screenshot mit der SnapCenter-Konfiguration"]

. Überprüfen Sie die Zusammenfassung, und beenden Sie sie, um den Datenbankschutz zu aktivieren.
+
image:vcf_orarac_vvol_snapctr_bkup_06.png["Screenshot mit der SnapCenter-Konfiguration"]

. On-Demand Backup-Job kann durch Klick auf ausgelöst werden `Back up Now`.
+
image:vcf_orarac_vvol_snapctr_bkup_07.png["Screenshot mit der SnapCenter-Konfiguration"] image:vcf_orarac_vvol_snapctr_bkup_08.png["Screenshot mit der SnapCenter-Konfiguration"]

. Der Backupjob kann am überwacht werden `Monitor` Klicken Sie auf den laufenden Job.
+
image:vcf_orarac_vvol_snapctr_bkup_09.png["Screenshot mit der SnapCenter-Konfiguration"]

. Klicken Sie auf Datenbank, um die für die RAC-Datenbank abgeschlossenen Backup-Sets zu überprüfen.
+
image:vcf_ora_vvol_snapctr_bkup_10.png["Screenshot mit der SnapCenter-Konfiguration"]



====


==== Datenbank-Restore/-Recovery

[%collapsible]
====
SnapCenter bietet verschiedene Wiederherstellungs- und Recovery-Optionen für Oracle RAC Datenbanken aus dem Snapshot-Backup. In diesem Beispiel demonstrieren wir, wie die Daten aus einem älteren Snapshot-Backup wiederhergestellt werden, und führen dann ein Rollforward der Datenbank zum letzten verfügbaren Protokoll durch.

. Führen Sie zunächst ein Snapshot-Backup aus. Erstellen Sie anschließend eine Testtabelle und fügen Sie eine Zeile in die Tabelle ein, um zu überprüfen, ob die wiederhergestellte Datenbank aus dem Snapshot-Image vor der Erstellung der Testtabelle die Testtabelle wiederfindet.
+
....
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 10:31:12 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.


SQL> create table test (id integer, dt timestamp, event varchar(100));

Table created.

SQL> insert into test values (1, sysdate, 'validate SnapCenter rac database restore on VMware vVols storage');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage


SQL>

....
. Öffnen Sie auf der Registerkarte SnapCenter `Resources` die Seite NTAP1-Backup-Topologie der Datenbank. Markieren Sie den Snapshot Daten-Backup-Satz, der vor 3 Tagen erstellt wurde. Klicken Sie auf `Restore` , um den Wiederherstellungs-Workflow zu starten.
+
image:vcf_orarac_vvol_snapctr_restore_01.png["Screenshot mit der SnapCenter-Konfiguration"]

. Wählen Sie den Wiederherstellungsbereich aus.
+
image:vcf_orarac_vvol_snapctr_restore_02.png["Screenshot mit der SnapCenter-Konfiguration"]

. Wählen Sie den Wiederherstellungsbereich auf `All Logs`.
+
image:vcf_orarac_vvol_snapctr_restore_03.png["Screenshot mit der SnapCenter-Konfiguration"]

. Geben Sie alle optionalen Pre-Skripte an, die ausgeführt werden sollen.
+
image:vcf_orarac_vvol_snapctr_restore_04.png["Screenshot mit der SnapCenter-Konfiguration"]

. Geben Sie ein beliebiges optionales After-Script an, das ausgeführt werden soll.
+
image:vcf_orarac_vvol_snapctr_restore_05.png["Screenshot mit der SnapCenter-Konfiguration"]

. Senden Sie bei Bedarf einen Jobbericht.
+
image:vcf_orarac_vvol_snapctr_restore_06.png["Screenshot mit der SnapCenter-Konfiguration"]

. Überprüfen Sie die Zusammenfassung, und klicken Sie auf `Finish` Um die Wiederherstellung und Wiederherstellung zu starten.
+
image:vcf_orarac_vvol_snapctr_restore_07.png["Screenshot mit der SnapCenter-Konfiguration"]

. Von der RAC DB VM ora01 aus überprüfen, ob eine erfolgreiche Wiederherstellung/Wiederherstellung der Datenbank in den letzten Zustand vorgerollt wurde und die 3 Tage später erstellte Testtabelle zurückgewonnen hat.
+
....

[root@ora01 ~]# su - oracle
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 11:51:15 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP      READ WRITE

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage

SQL> select current_timestamp from dual;

CURRENT_TIMESTAMP
---------------------------------------------------------------------------
19-AUG-24 11.55.20.079686 AM -04:00



SQL> exit
Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

....


Hiermit ist die Demonstration von SnapCenter Backup, Wiederherstellung und Recovery von Oracle RAC Datenbanken in VCF mit VVols abgeschlossen.

====


== Wo Sie weitere Informationen finden

Weitere Informationen zu den in diesem Dokument beschriebenen Daten finden Sie in den folgenden Dokumenten bzw. auf den folgenden Websites:

* VMware Cloud Foundation
+
link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation"^]

* NetApp Lösungen für Enterprise Database
+
link:https://docs.netapp.com/us-en/netapp-solutions/databases/index.html["https://docs.netapp.com/us-en/netapp-solutions/databases/index.html"^]

* SnapCenter Software 6.0
+
link:https://docs.netapp.com/us-en/snapcenter/concept/concept_snapcenter_overview.html["https://docs.netapp.com/us-en/snapcenter/concept/concept_snapcenter_overview.html"^]

* Dokumentation zu ONTAP Tools für VMware vSphere
+
link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html"^]


