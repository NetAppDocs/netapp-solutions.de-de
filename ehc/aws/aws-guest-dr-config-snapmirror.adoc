---
sidebar: sidebar 
permalink: ehc/aws/aws-guest-dr-config-snapmirror.html 
keywords: Intercluster logical interfaces, cluster peering, SVM peering, snapshot retention policy, destination volumes, SnapMirror relationships 
summary: 'SnapCenter kann SnapMirror Beziehungen innerhalb des primären Storage-Systems (primär > Spiegel) und auf sekundäre Storage-Systeme (primär > Vault) aktualisieren, um langfristige Archivierung und Aufbewahrung zu ermöglichen. Hierfür müssen eine Datenreplizierungsbeziehung zwischen einem Ziel-Volume und einem Quell-Volume mithilfe von SnapMirror festgelegt und initialisiert werden.' 
---
= SnapMirror Beziehungen und Aufbewahrungszeitpläne konfigurieren
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../../media/


link:aws-guest-dr-snapcenter-overview.html["Zurück: Übersicht - Disaster Recovery."]

SnapCenter kann SnapMirror Beziehungen innerhalb des primären Storage-Systems (primär > Spiegel) und auf sekundäre Storage-Systeme (primär > Vault) aktualisieren, um langfristige Archivierung und Aufbewahrung zu ermöglichen. Hierfür müssen eine Datenreplizierungsbeziehung zwischen einem Ziel-Volume und einem Quell-Volume mithilfe von SnapMirror festgelegt und initialisiert werden.

Die Quell- und Ziel-ONTAP Systeme müssen sich in Netzwerken befinden, die über Amazon VPC Peering, ein Transit-Gateway, AWS Direct Connect oder ein AWS VPN Peering durchgeführt werden.

Die folgenden Schritte sind zum Einrichten von SnapMirror Beziehungen zwischen einem lokalen ONTAP System und FSX ONTAP erforderlich:

* Notieren Sie die logischen Schnittstellen der Quell- und Zielcluster.
* Cluster-Peering zwischen ONTAP und FSX einrichten.
* SVM-Peering-Beziehung aufbauen.
* Erstellen einer Snapshot Aufbewahrungsrichtlinie
* Erstellen Sie das Ziel-Volume in FSX.
* SnapMirror Beziehungen zwischen Quell- und Ziel-Volumes erstellen
* SnapMirror Beziehungen initialisieren.


Siehe https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/ONTAPGuide.pdf["FSX für ONTAP – ONTAP-Benutzerhandbuch"^] Weitere Informationen zum Erstellen von SnapMirror Beziehungen mit FSX.



== Zeichnen Sie die logischen Schnittstellen von Intercluster und Ziel auf

Für das lokale ONTAP Quellsystem können Sie die LIF-Informationen zwischen Clustern von System Manager oder über die CLI abrufen.

. Wechseln Sie in ONTAP System Manager zur Seite „Netzwerkübersicht“ und rufen Sie die IP-Adressen des Typs „Intercluster“ ab, die für die Kommunikation mit der AWS VPC konfiguriert sind, bei der FSX installiert ist.
+
image:dr-vmc-aws-image10.png["Fehler: Fehlendes Grafikbild"]

. Um die Intercluster-IP-Adressen für FSX abzurufen, melden Sie sich in der CLI an und führen Sie den folgenden Befehl aus:
+
....
FSx-Dest::> network interface show -role intercluster
....
+
image:dr-vmc-aws-image11.png["Fehler: Fehlendes Grafikbild"]





== Cluster-Peering zwischen ONTAP und FSX einrichten

Zum Erstellen von Cluster-Peering zwischen ONTAP Clustern muss im anderen Peer-Cluster eine eindeutige Passphrase bestätigt werden, die beim Initiierung des ONTAP-Clusters eingegeben wurde.

. Richten Sie mithilfe des Peering auf dem Ziel-FSX-Cluster ein `cluster peer create` Befehl. Wenn Sie dazu aufgefordert werden, geben Sie eine eindeutige Passphrase ein, die später im Quellcluster verwendet wird, um den Erstellungsprozess abzuschließen.
+
....
FSx-Dest::> cluster peer create -address-family ipv4 -peer-addrs source_intercluster_1, source_intercluster_2
Enter the passphrase:
Confirm the passphrase:
....
. Im Quell-Cluster können Sie die Cluster-Peer-Beziehung entweder mit ONTAP System Manager oder der CLI einrichten. Navigieren Sie im ONTAP System Manager zu Schutz > Übersicht, und wählen Sie Peer Cluster aus.
+
image:dr-vmc-aws-image12.png["Fehler: Fehlendes Grafikbild"]

. Füllen Sie im Dialogfeld Peer Cluster die erforderlichen Informationen aus:
+
.. Geben Sie die Passphrase ein, die zum Erstellen der Peer-Cluster-Beziehung auf dem Ziel-FSX-Cluster verwendet wurde.
.. Wählen Sie `Yes` Um eine verschlüsselte Beziehung aufzubauen.
.. Geben Sie die Intercluster-LIF-IP-Adresse(n) des Ziel-FSX-Clusters ein.
.. Klicken Sie auf Cluster Peering initiieren, um den Prozess abzuschließen.
+
image:dr-vmc-aws-image13.png["Fehler: Fehlendes Grafikbild"]



. Überprüfen Sie den Status der Cluster-Peer-Beziehung vom FSX-Cluster mit dem folgenden Befehl:
+
....
FSx-Dest::> cluster peer show
....
+
image:dr-vmc-aws-image14.png["Fehler: Fehlendes Grafikbild"]





== SVM-Peering-Beziehung einrichten

Im nächsten Schritt werden eine SVM-Beziehung zwischen den Ziel- und Quell-Storage Virtual Machines eingerichtet, die die Volumes enthalten, die sich in den SnapMirror Beziehungen befinden.

. Verwenden Sie für den Quell-FSX-Cluster den folgenden Befehl aus der CLI, um die SVM-Peer-Beziehung zu erstellen:
+
....
FSx-Dest::> vserver peer create -vserver DestSVM -peer-vserver Backup -peer-cluster OnPremSourceSVM -applications snapmirror
....
. Akzeptieren Sie vom ONTAP-Quellcluster die Peering-Beziehung entweder mit dem ONTAP System Manager oder der CLI.
. Wählen Sie im ONTAP System Manager unter „Protection > Overview“ die Option „Peer Storage VMs“ unter „Storage VM Peers“ aus.
+
image:dr-vmc-aws-image15.png["Fehler: Fehlendes Grafikbild"]

. Füllen Sie im Dialogfeld Peer Storage VM die erforderlichen Felder aus:
+
** Der Quell-Storage-VM
** Dem Ziel-Cluster
** Der Ziel-Storage-VM
+
image:dr-vmc-aws-image16.png["Fehler: Fehlendes Grafikbild"]



. Klicken Sie auf Peer Storage VMs, um den SVM-Peering-Prozess abzuschließen.




== Erstellen einer Snapshot Aufbewahrungsrichtlinie

SnapCenter managt Aufbewahrungszeitpläne für Backups, die als Snapshot Kopien auf dem primären Storage-System existieren. Dies wird beim Erstellen einer Richtlinie in SnapCenter festgelegt. SnapCenter managt keine Aufbewahrungsrichtlinien für Backups, die in sekundären Storage-Systemen aufbewahrt werden. Diese Richtlinien werden separat durch eine SnapMirror Richtlinie gemanagt, die auf dem sekundären FSX-Cluster erstellt wurde und mit den Ziel-Volumes in einer SnapMirror Beziehung zum Quell-Volume verknüpft ist.

Beim Erstellen einer SnapCenter-Richtlinie haben Sie die Möglichkeit, ein sekundäres Richtlinienetikett anzugeben, das der SnapMirror-Kennzeichnung von jedem Snapshot hinzugefügt wird, der beim Erstellen eines SnapCenter-Backups generiert wird.


NOTE: Auf dem sekundären Storage werden diese Kennungen mit Richtliniensegeln abgeglichen, die mit dem Ziel-Volume verbunden sind, um die Aufbewahrung von Snapshots zu erzwingen.

Das folgende Beispiel zeigt ein SnapMirror-Etikett, das an allen Snapshots vorhanden ist, die im Rahmen einer Richtlinie erzeugt wurden, die für die täglichen Backups unserer SQL Server-Datenbank und der Protokoll-Volumes verwendet wird.

image:dr-vmc-aws-image17.png["Fehler: Fehlendes Grafikbild"]

Weitere Informationen zum Erstellen von SnapCenter-Richtlinien für eine SQL Server-Datenbank finden Sie im https://docs.netapp.com/us-en/snapcenter/protect-scsql/task_create_backup_policies_for_sql_server_databases.html["SnapCenter-Dokumentation"^].

Sie müssen zuerst eine SnapMirror-Richtlinie mit Regeln erstellen, die die Anzahl der beizubehaltenden Snapshot-Kopien vorschreiben.

. Erstellen Sie die SnapMirror-Richtlinie auf dem FSX-Cluster.
+
....
FSx-Dest::> snapmirror policy create -vserver DestSVM -policy PolicyName -type mirror-vault -restart always
....
. Fügen Sie der Richtlinie Regeln mit SnapMirror-Labels hinzu, die zu den in den SnapCenter-Richtlinien angegebenen sekundären Richtlinienbezeichnungen passen.
+
....
FSx-Dest::> snapmirror policy add-rule -vserver DestSVM -policy PolicyName -snapmirror-label SnapMirrorLabelName -keep #ofSnapshotsToRetain
....
+
Das folgende Skript enthält ein Beispiel für eine Regel, die einer Richtlinie hinzugefügt werden kann:

+
....
FSx-Dest::> snapmirror policy add-rule -vserver sql_svm_dest -policy Async_SnapCenter_SQL -snapmirror-label sql-ondemand -keep 15
....
+

NOTE: Erstellen Sie für jedes SnapMirror Label zusätzliche Regeln und die Anzahl der zu behaltenden Snapshots (Aufbewahrungszeitraum).





== Erstellung von Ziel-Volumes

Führen Sie den folgenden Befehl auf FSX ONTAP aus, um ein Ziel-Volume auf FSX zu erstellen, das den Empfänger von Snapshot-Kopien aus unseren Quell-Volumes erhält:

....
FSx-Dest::> volume create -vserver DestSVM -volume DestVolName -aggregate DestAggrName -size VolSize -type DP
....


== SnapMirror Beziehungen zwischen Quell- und Ziel-Volumes erstellen

Führen Sie den folgenden Befehl auf FSX ONTAP aus, um eine SnapMirror Beziehung zwischen einem Quell- und Ziel-Volume zu erstellen:

....
FSx-Dest::> snapmirror create -source-path OnPremSourceSVM:OnPremSourceVol -destination-path DestSVM:DestVol -type XDP -policy PolicyName
....


== SnapMirror Beziehungen initialisieren

Initialisieren Sie die SnapMirror-Beziehung. Bei diesem Prozess wird ein neuer Snapshot initiiert, der vom Quell-Volume erzeugt wird und in das Ziel-Volume kopiert.

Um ein Volume zu erstellen, führen Sie den folgenden Befehl auf FSX ONTAP aus:

....
FSx-Dest::> volume create -vserver DestSVM -volume DestVolName -aggregate DestAggrName -size VolSize -type DP
....
link:aws-guest-dr-config-snapcenter.html["Als Nächstes: Implementieren und konfigurieren Sie Windows SnapCenter Server vor Ort."]
